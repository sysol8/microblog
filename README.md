# Microblog

**Microblog** - Простой микроблог на базе React и FastAPI, демонстрирующий сквозной цикл разработки от клиентской части до серверного API и валидации данных.

## Основные возможности

- Лента постов с бесконечной прокруткой;
- Мультиавторство: каждый пост связан с профилем автора;
- Клиентский роутинг через React Router;
- Кастомизация профиля: пользователь может менять свой никнейм и загружать аватар;
- Подсчёт лайков: на странице профиля показывается общее количество лайков всех постов автора, а также список избранных записей;
- Формы и валидация: демонстрируется работа с формами регистрации и авторизации пользователя, создания и редактирования постов;
- Авторизация и учёт прав: регистрация, логин, хранение токена, защита приватных маршрутов;

## Технологический стек

- Клиент: React с TypeScript, React Router, кастомные хуки, CSS Modules.
- Стор на клиенте - Zustand.
- Сервер: FastAPI на Python, Pydantic для валидации, асинхронная запись в базу данных.
- Хранение данных: PostgreSQL для долговечного хранения постов и пользователей; Redis в качестве быстрого кэша; облачное S3-хранилище для хранения загружаемых пользователями файлов.
- Сборка и конфигурация: Vite, ESLint, Prettier.

## Архитектура
- Инициализация приложения и роутинг в `main.tsx`;
- Папка `layouts` для страниц приложения: общий лейаут `AppLayout.tsx`, специфичные лейауты для отдельных маршрутов: `AuthLayout.tsx`, `PostsLayout.tsx`, `ProfileLayout.tsx`;
- Папка `components` для переиспользуемых UI-блоков `Modal.tsx`, `Alert.tsx`, `Toast.tsx` и др.
- Стилизация компонентов при помощи CSS-модулей, которые хранятся рядом с компонентами в соответствующих папках. Стили компонентов практически полностью изолированы друг от друга, что позволяет редактировать их без вероятности "поломать" отображение;
- Папка `hooks` для кастомных хуков (`useAuth`, `useInfiniteScroll`, `usePosts`).
- Папка `api` с файлами, содержащими обёртку HTTP-клиента и наборы функций для работы с отдельными эндпоинтами эндпоинтами.
- `utils/utils.ts` для вспомогательных скриптов
- Серверная часть: `middleware` для работы с HTTP-запросами в режиме CORS при разработке, `models` для описания моделей данных в БД, `schemas` для определения схем данных, отправляемых на клиент, `main` - точка входа. Работа с постами реализована при помощи отдельного роута, что позволяет достигнуть низкой связанности модулей. Сам роут `posts` содержит CRUD-операции для работы с постами и взаимодействия с базой данных.

## Основные сущности
- `Post` - публикация в ленте. Содержит поля: 
   - `id` - уникальный идентификатор поста;
   - `author` - `id` пользователя, опубликовавшего пост; 
   - `content` - user-generated содержимое поста:
     - `textContent` - текстовое содержимое поста;
     - `attachments` - ссылки на облачное хранилище для прикрепленных к посту изображений.
   - `createdAt` - дата публикации; 
   - `isLiked` - булево поле, определяет, лайкнул ли конкретный пользователь данный пост; 
   - `likes` - общее количество лайков;
   - `watches` - общее количество просмотров поста;
   - `reposts` - общее количество репостов.
- `User` - пользователь. Содержит поля:
  - `id` - уникальный идентификатор пользователя; 
  - `name` - отображаемое имя пользователя;
  - `avatarUrl` - ссылка на аватар в облачном хранилище; 
  - `posts` - содержит всю информацию о постах пользователя:
    - `total` - общее количество постов;
    - `totalLikes` - общее количество лайков на постах пользователя;
    - `items` - сами посты, в т. ч. репосты.
  - `likes` - посты, лайкнутые пользователем; 
  - `createdAt` - дата регистрации;
  - `subscribers` - подписчики пользователя;
  - `subscriptions` - подписки пользователя.

## Компоненты
- `Post` - компонент поста. Принимает данные поста, а также экшены;
- `PostsList` - простой список постов. Рендерит новый `Post` для каждого элемента в массиве данных, приходящих с сервера;
- `PostForm` - форма для создания поста. Содержит текстовое поле, отображает лимит доступных для ввода символов. К форме можно прикреплять файлы-изображения с предпросмотром;
- `Modal` - общий компонент модального окна, который позволяет отображать динамический контент. Состояние `Modal` хранится в глобальном хранилище, описанном в `store/modal.ts`;
- `ImageModal` - связанный с модальным окном компонент (при этом не дублирующий его логику), отображающий галерею изображений с контролами для перелистывания (+ поддержка управления с клавиатуры).
- `AuthForm` - компонент, содержащий формы авторизации и регистрации в разных табах;
- `ImagePreview` - предпросмотр прикрепленных к форме изображений. Осуществляет проверку типа файла и возвращает превью картинки через `URL.createObjectURL()` или же `<span>` с названием файла, если файл не является изображением;
- `Alert` - компонент-уведомление. Принимает тип уведомления, от которого зависит внешний вид компонента, и отображаемое сообщение (ошибка, успех, предупреждение и др.);
- `Toast` - компонент для отображения алертов в стэке;
-  Папка `layouts` содержит общие для лейаутов компоненты, например, `Header` и `Footer`;

## Лейауты
Приложение содержит 4 разных лейаута:
- `AppLayout` - главный, "абстрактный" лейаут приложения. Содержит провайдер модального окна, шапку и подвал страницы, а также `Outlet`, в котором рендерятся другие лейауты;
- `PostsLayout` отвечает за отображение основного контента приложения. Распаковывает данные и методы от хука `usePosts`. Массив постов и метод удаления поста отдает в компонент `PostsList`, метод добавления поста отдает в форму создания;
- `AuthLayout` содержит формы авторизации и регистрации. Пользователя редиректит на роут с данным лейаутом при попытке осуществить защищенные действия без авторизации: поставить лайк, сделать репост, посмотреть собственный профиль и др.;
- `ProfileLayout` отображает подробную информацию о пользователе.

## Хуки
- `usePosts`. Возвращает состояния загрузки и ошибки; массив постов; методы добавления и удаления поста.

## Установка и запуск

1. Склонировать репозиторий.
    ```
    git clone https://github.com/sysol8/microblog.git
   ```
2. Установить зависимости клиента.
    ```
    npm i
   ```
3. Установить зависимости бэкенда.
    ```
   cd server
   python -m venv venv
   venv/scripts/activate
   pip install -r requirments.txt
   ```

4. Запустить бэкенд.
    ```
    fastapi dev
   ```
5. Запустить дев-сервер.
    ```
   cd ..
   npm run dev
   ```
6. Перейти на http://localhost:5173. 

## Что можно добавить
- Реализовать систему комментариев и тредов под каждым постом.
- Реализовать систему уведомлений и обновления ленты в realtime через Server-Sent Events/Long-polling;
- Сделать светлую тему с переключателем и запоминанием выбора.
- Реализовать поиск по контенту и фильтрацию ленты (теги, даты, популярность).
- Добавить пагинацию и сортировку как альтернативу бесконечной прокрутке.
- Разработать админ-панель для модерации постов и управления пользователями.
- Расширить авторизацию через OAuth.
- Настроить CI/CD-процессы, покрыть код тестами (unit, integration, e2e).
- Запаковать приложение в Docker-контейнеры и задеплоить в облако.
